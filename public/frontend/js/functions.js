/**
 * Created by Mr.Phu on 09/05/2017.
 */
var note522c = ["<font color = 'red'><b>TỐT</b></font>: (Gặp khoảng này gia cảnh được khả quan, làm ăn phát đạt, bạn bè trung thành, con cái thông minh hiếu thảo).", "<b>XẤU</b>: (Gặp khoảng hiểm họa gia chủ sẽ bị tán tài lộc, trôi dạt tha phương, cuộc sống túng thiếu, gia đạo có người đau ốm, con cái dâm ô hư thân mất nết, bất trung bất hiếu).", "<b>XẤU</b>: (Gặp khoảng này coi chừng ốm đau nặng, chết chóc, mất của, vợ chồng sống bất hòa, con cái gặp nạn).", "<font color = 'red'><b>TỐT</b></font>: (Gặp khoảng THIÊN TÀI chủ nhà luôn may mắn về tài lộc, năng tài đắc lợi, con cái được nhờ vả, hiếu thảo, gia đạo chí thọ, an vui).", "<font color = 'red'><b>TỐT</b></font>: (Tại khoảng này chủ nhà luôn gặp sung túc, phúc lộc, nghề nghiệp luôn phát triển, năng tài đắc lợi, con cái thông minh, hiếu thảo).", "<b>XẤU</b>: (Khoảng này gia chủ hao người, hao của, biệt ly, con cái ngỗ nghịch, tửu sắc vô độ đến chết).", "<b>XẤU</b>: (Gặp khoảng THIÊN TẶC phải coi chừng bệnh đến bất ngờ, hay bị tai bay vạ gió, kiện tụng, tù ngục, chết chóc).", "<font color = 'red'><b>TỐT</b></font>: (Khoảng TỂ TƯỚNG tạo cho gia chủ hanh thông mọi mặt, con cái tấn tài danh, sinh con quý tử, chủ nhà luôn may mắn bất ngờ)."],
    note429c = ["<font color = 'red'><b>TỐT</b></font>", "<b>XẤU</b>", "<b>XẤU</b>", "<font color = 'red'><b>TỐT</b></font>", "<font color = 'red'><b>TỐT</b></font>", "<b>XẤU</b>", "<b>XẤU</b>", "<font color = 'red'><b>TỐT</b></font>"],
    note429c2 = ["Khoảng <font color = 'red'><b>TÀI</b></font> ứng nghiệm tốt nhất với cổng lớn, nơi đón nhận của cải từ ngoài vào.", "Khoảng <b>BỆNH</b> ứng đặc biệt vào nhà vệ sinh. Nơi này thường là góc hung (xấu) của nhà. Cửa lọt vào chữ Bệnh sẽ thuận lợi cho bệnh tật sinh ra.", "Khoảng <b>LY</b> rất kị cho cửa trong nhà. Cửa lọt vào chữ Ly, chồng thì làm ăn xa nhà, vợ gặp điều quyến rũ, con cái hoang đàng phá phách.", "Khoảng <font color = 'red'><b>NGHĨA</b></font> rất tốt cho cổng lớn và cửa nhà bếp, cửa các phòng thông nhau thì không nên.", "Khoảng <font color = 'red'><b>QUAN</b></font> tốt ở cửa phòng riêng vợ chồng vì sẽ sinh con quí tử nhưng rất kị ở cổng lớn vì tránh chuyện kiện tụng ra chính quyền.", "Khoảng <b>KIẾP</b> tượng trưng cho tai họa khách quan đến từ bên ngoài khiến hao tổn tiền của. Tránh ở cổng lớn, nhất là các cửa hàng, tiệm buôn càng nên lưu ý.", "Khoảng <b>HẠI</b> tượng trưng cho mầm xấu nhen nhúm từ bên trong, kị ở các cửa phòng trong nhà.", "Khoảng <font color = 'red'><b>BẢN</b></font> Thích hợp cho cổng lớn."],
    note429k = ["Có tiền của và có đức", "Kho vàng, của cải sung túc", "Hòa hợp gia đạo gồm cha mẹ, vợ chồng, con cháu", "Đón nhận phúc đến: gặp nhiều hạnh phúc, may mắn", "Hao tốn tiền của, làm ăn thua lỗ", "Tranh chấp, thưa kiện ra chính quyền", "Vướng vào vòng lao lý, tù tội", "Chịu phận cô đơn", "Dây dưa nhiều chuyện", "Bị cướp của", "Chuyện xấu với chính quyền", "Mất mát", "Thêm con trai", "Gặp nhiều lợi ích, thuận lợi", "Con giỏi, ngoan", "Rất tốt, trăm sự đều hay, may mắn thuận lợi", "Thi cử thuận lợi", "Được tiền của bất ngờ, không nằm trong dự tính", "Làm ăn phát đạt, được nhiều người yêu mến, kính trọng", "Giàu có, danh vọng", "Chia lìa chết chóc", "Gia đạo ngày càng ít người, tử nhiều hơn sinh", "Xa cách quê nhà", "Làm ăn thất bại, của cải tiêu tan", "Tai họa đến", "Rất xấu, người chết, công việc thất bại, phá sản", "Mắc bệnh hiểm nghèo", "Mang họa vì lời nói", "Tiền của đến, công việc làm ăn thuận lợi", "Thi cử đỗ đạt, công thành danh toại", "Của cải gia tăng không ngừng", "Làm ăn thịnh vượng"],
    note388c = ["<font color = 'red'><b>TỐT</b></font>", "<b>XẤU</b>", "<font color = 'red'><b>TỐT</b></font>", "<b>XẤU</b>", "<font color = 'red'><b>TỐT</b></font>", "<font color = 'red'><b>TỐT</b></font>", "<b>XẤU</b>", "<font color = 'red'><b>TỐT</b></font>", "<b>XẤU</b>", "<font color = 'red'><b>TỐT</b></font>"],
    note388k = ["Gia tăng phúc đức, luôn gặp may mắn, khi có tai họa có người cứu giúp", "Thi cử đỗ đạt", "Được nhiều tiền của", "Thi cử đỗ đạt, học hành tốt.", "Mang họa vì lời nói", "Dễ mắc bệnh tật hiểm nghèo", "Rất xấu, người chết, tổn thất chia lìa đến nhanh chóng", "Tai họa đến liên miên, không dứt", "Hưởng lộc từ trời", "Gặp nhiều chuyện vui", "Được của quý", "Đón nhận phúc, gia tăng phúc lộc", "Mất mát, vật phẩm đồ đạc bị thất lạc, người ly biệt", "Chuyện xấu với chính quyền", "Bị cướp của", "Không có con nối dõi", "Cát tường, cát lợi, may mắn", "Tài lộc tăng, kinh doanh buôn bán phát đạt", "Gặp nhiều lợi ích, thuận lợi", "Kho trời, hưởng phúc lộc, tiền tài", "Giàu có, danh vọng", "Của cải gia tăng không ngừng", "Được của cải bất ngờ, không nằm trong dự tính", "Thi cử thuận lợi", "Xa cách quê nhà", "Chia lìa chết chóc", "Con trai gặp nhiều bất lợi, đi xa hoặc tử biệt", "Mất tiền của, kinh doanh sút kém", "Thi cử đỗ đạt, học hành tốt.", "Con hiền ngoan, có tài đức", "Có thêm con trai", "Làm ăn thịnh vượng", "Chịu phận cô đơn", "Chỉ sự thương vong, vướng vào vòng lao lý, tù tội", "Tranh chấp, thưa kiện ra chính quyền", "Hao tốn tiền của, làm ăn thua lỗ", "Đón nhận phúc đức", "Hòa hợp gia đạo, mọi việc thuận lợi.", "Của cải gia tăng không ngừng", "Có tiền của và có đức"],
    lcung = [
        ["QUÝ NHÂN", "HIỂM HỌA", "THIÊN TAI", "THIÊN TÀI", "NHÂN LỘC", "CÔ ĐỘC", "THIÊN TẶC", "TỂ TƯỚNG"],
        ["Tài", "Bệnh", "Ly", "Nghĩa", "Quan", "Kiếp", "Hại", "Bản"],
        ["Đinh", "Hại", "Vượng", "Khổ", "Nghĩa", "Quan", "Tử", "Hưng", "Thất", "Tài"]
    ],
    lkhoang = [
        ["Quyền Lộc", "Trung Tín", "Tác Quan", "Phát Đạt", "Thông Minh", "Án Thành", "Hỗn Nhân", "Thất Hiếu", "Tai Họa", "Trường Bệnh", "Hoàn Tử", "Quan Tài", "Thân Tàn", "Thất Tài", "Hệ Quả", "Thi Thơ", "Văn Học", "Thanh Quý", "Tác Lộc", "Thiên Lộc", "Trí Tồn", "Phú Quý", "Tiến Bửu", "Thập Thiện", "Văn Chương", "Bạc Nghịch", "Vô Vọng", "Ly Tán", "Tửu Thục", "Dâm Dục", "Phong Bệnh", "Chiêu Ôn", "Ồn Tài", "Ngục Tù", "Quang Tài", "Đại Tài", "Thi Thơ", "Hoạch Tài", "Hiếu Tử", "Quý Nhân"],
        ["Tài Đức", "Bảo Khố", "Lục Hợp", "Nghênh Phúc", "Thoái Tài", "Công Sự", "Lao Chấp", "Cô Quả", "Trường Bệnh", "Kiếp Tài", "Quan Quỉ", "Thất Thoát", "Thêm Đinh", "Ích Lợi", "Quí Tử", "Đại Cát", "Thuận Khoa", "Hoạch Tài", "Tấn Đức", "Phú Quí", "Tử Biệt", "Khoái Khẩu", "Ly Hương", "Thất Tài", "Tai Chí", "Tử Tuyệt", "Lâm Bệnh", "Khẩu Thiệt", "Tài Chí", "Đăng Khoa", "Tiến Bảo", "Hưng Vượng"],
        ["Phúc Tinh", "Cấp Đệ", "Tài Vượng", "Đăng Khoa", "Khẩu Thiệt", "Lâm Bệnh", "Tử Tuyệt (Tử Huyệt)", "Tai Chí", "Thiên Đức", "Hỷ Sự", "Tiến Bảo", "Nạp Phúc", "Thất Thoát", "Quan Quỉ", "Kiếp Tài", "Vô Tự", "Đại Cát", "Tài Vượng", "Ích Lợi", "Thiên Khố", "Phú Quí", "Tiến Bảo", "Hoạch Tài", "Thuận Khoa", "Ly Hương", "Tử Biệt", "Thoái Đinh", "Thất Tài", "Đông Khoa", "Quí Tử", "Thêm Đinh", "Hưng Vượng", "Cô Quả", "Lao Chấp", "Công Sự", "Thoái Tài", "Nghênh Phúc", "Lục Hợp", "Tiến Bảo", "Tài Đức"]
    ],
    lmau = [
        ["#ff0000", "#000000", "#000000", "#ff0000", "#ff0000", "#000000", "#000000", "#ff0000"],
        ["#ff0000", "#000000", "#000000", "#ff0000", "#ff0000", "#000000", "#000000", "#ff0000"],
        ["#ff0000", "#000000", "#ff0000", "#000000", "#ff0000", "#ff0000", "#000000", "#ff0000", "#000000", "#ff0000"]
    ],
    ldodaithuoc = [522, 429, 388],
    lnumcung = [8, 8, 10],
    lnumkhoang = [40, 32, 40],

    //Mỗi đoạn thước dài 1000mm
    rulerLength = 1000, //Số đo 1 đoạn thước (mm)
    trimStart = 0,  //Số đo đầu của thước (mm)
    trimEnd = 1000, //Số đo cuối của thước (mm)

    myScroll;
    var qStr = 0;
// function pullRightAction () {
//     if(trimStart > 0) {
//         $('#loban-scroller').width(function(i,width){
//             return width + 10000;
//         });
//         trimStart -= rulerLength;
//         var qStr = '?trimStart='+trimStart+'&rulerLength='+rulerLength;
//         var newLi = $('<li>').append($('<img/>', { src: base_url()+'/public/frontend/images/thuoc522.php'+qStr }))
//             .append($('<img/>', { src: base_url()+'/public/frontend/images/thuoc429.php'+qStr }))
//             .append($('<img/>', { src: base_url()+'/public/frontend/images/thuoc388.php'+qStr }));
//         $('#loban-thelist').prepend(newLi);
//         myScroll.refresh();
//     }
// }
//
// function pullLeftAction () {
//     if(trimEnd < 50000) {
//         $('#loban-scroller').width(function(i,width){
//             return width + 10000;
//         });
//         var qStr = '?trimStart='+trimEnd+'&rulerLength='+rulerLength;
//         var newLi = $('<li>').append($('<img/>', { src: base_url()+'/public/frontend/images/thuoc522.php'+qStr }))
//             .append($('<img/>', { src: base_url()+'/public/frontend/images/thuoc429.php'+qStr }))
//             .append($('<img/>', { src: base_url()+'/public/frontend/images/thuoc388.php'+qStr }));
//         trimEnd += rulerLength;
//         $('#loban-thelist').append(newLi);
//         myScroll.refresh();
//     }
// }

function pullRightAction() {
    if (trimStart > 0) {
        jQuery('#loban-scroller').width(function (i, width) {
            return width + 10000;
        });
        trimStart -= rulerLength;
        /*var qStr = '?trimStart=' + trimStart + '&rulerLength=' + rulerLength;*/

        qStr = qStr + 1000;

        var newLi = jQuery('<li>').append(jQuery('<img/>', {src: base_url()+'/public/frontend/images/loban/thuoc522' + '-' + qStr + '.png'}))
            .append(jQuery('<img/>', {src: base_url()+'/public/frontend/images/loban/thuoc429' + '-' + qStr + '.png'}))
            .append(jQuery('<img/>', {src: base_url()+'/public/frontend/images/loban/thuoc388' + '-' + qStr + '.png'}));

        jQuery('#loban-thelist').prepend(newLi);
        myScroll.refresh();
    }

}


function pullLeftAction() {
    if (trimEnd < 50000) {
        jQuery('#loban-scroller').width(function (i, width) {
            return width + 10000;
        });
        /*var qStr = '?trimStart=' + trimEnd + '&rulerLength=' + rulerLength;*/
        qStr = qStr + 1000;

        var newLi = jQuery('<li>').append(jQuery('<img/>', {src: base_url()+'/public/frontend/images/loban/thuoc522' + '-' + qStr + '.png'}))
            .append(jQuery('<img/>', {src: base_url()+'/public/frontend/images/loban/thuoc429' + '-' + qStr + '.png'}))
            .append(jQuery('<img/>', {src: base_url()+'/public/frontend/images/loban/thuoc388' + '-' + qStr + '.png'}));
        trimEnd += rulerLength;
        jQuery('#loban-thelist').append(newLi);
        myScroll.refresh();
    }
}

function loaded() {
    Math.nativeRound = Math.round;
    Math.round = function(i, iDecimals) {
        if (!iDecimals)
            return Math.nativeRound(i);
        else
            return Math.nativeRound(i * Math.pow(10, Math.abs(iDecimals))) / Math.pow(10, Math.abs(iDecimals));

    };

    myScroll = new iScroll('loban-wrapper', {
        useTransition: true,
        leftOffset: $('#pullRight').outerWidth(true),
        onRefresh: function () {
            $('#thanhdo').css({'left': $('#lobanOuter').width()/2 + 'px' });
            //$('#container-sodo').css({'left': ($('#lobanOuter').width()/2 - 32) + 'px' });
            if ($('#pullRight').hasClass('loading')) {
                $('#pullRight').removeClass('loading');
                $('#pullRight .pullRightLabel').html('Kéo qua phải...');
            } else if ($('#pullLeft').hasClass('loading')) {
                $('#pullLeft').removeClass('loading');
                $('#pullLeft .pullLeftLabel').html('Kéo qua trái...');
            }
            $('#sodoLoban').html(Math.round((-this.x+$('#lobanOuter').width()/2)/100,1) + ' cm');
            $('#sodo').val(Math.round((-this.x+$('#lobanOuter').width()/2)/10,0));
            getNoiDungHienThi(Math.round((-this.x+$('#lobanOuter').width()/2)/100,1));
        },
        onScrollMove: function () {
            $('#sodoLoban').html(Math.round((-this.x+$('#lobanOuter').width()/2)/100,1) + ' cm');
            $('#sodo').val(Math.round((-this.x+$('#lobanOuter').width()/2)/10,0));
            getNoiDungHienThi(Math.round((-this.x+$('#lobanOuter').width()/2)/100,1));
        },
        onScrollEnd: function () {
            console.log("onScrollEnd: " + this.x);
            if (this.x == 0 && !$('#pullRight').hasClass('flip')) {
                console.log("pullRight add class 'flip'");
                $('#pullRight').addClass('flip');
                $('#pullRight .pullRightLabel').html('Thả ra để làm mới...');
            } else if (-this.x > ($('#loban-scroller').width() - 2000) && !$('#pullLeft').hasClass('flip')) {
                console.log("pullLeft add class 'flip'");
                $('#pullLeft').addClass('flip');
                $('#pullLeft .pullLeftLabel').html('Thả ra để làm mới...');
            }

            $('#abc').html('this.x='+this.x+' : out='+($('#loban-scroller').width()-2000));

            if ($('#pullRight').hasClass('flip')) {
                $('#pullRight').removeClass('flip');
                $('#pullRight').addClass('loading');
                $('#pullRight .pullRightLabel').html('...');
                console.log("pullRightAction");
                pullRightAction();	// Execute custom function (ajax call?)
            } else if ($('#pullLeft').hasClass('flip')) {
                $('#pullLeft').removeClass('flip');
                $('#pullLeft').addClass('loading');
                $('#pullLeft .pullLeftLabel').html('...');
                console.log("pullLeftAction");
                pullLeftAction();	// Execute custom function (ajax call?)
            }
            $('#sodoLoban').html(Math.round((-this.x+$('#lobanOuter').width()/2)/100,1) + ' cm');
            $('#sodo').val(Math.round((-this.x+$('#lobanOuter').width()/2)/10,0));
            getNoiDungHienThi(Math.round((-this.x+$('#lobanOuter').width()/2)/100,1));
        }
    });

    setTimeout(function () { document.getElementById('loban-wrapper').style.left = '0'; }, 800);


    $('#sodo').blur(function(){
        var px = parseFloat($(this).val())*10
        px += $('#lobanOuter').width()/2;
        var st = Math.ceil((px-trimEnd*10)/10000)
        if(st>0){
            for(var i=1;i<=st;i++){
                pullLeftAction();
            }
            myScroll.refresh();
        }
        myScroll.scrollTo(-(px-Math.round($('#lobanOuter').width(),0)),0,Math.max((st+1)*500, 1500))
    });

    $('#sodo').bind('keypress', function(e) {
        var code = e.keyCode || e.which;
        if(code == 13) {
            $(this).blur()
        }
        else {
            if(!((code == 46) || (code>=48 && code<=57))){
                return false;
            }
        }
    });

}

document.addEventListener('DOMContentLoaded', function () { setTimeout(loaded, 200); }, false);

function getNoiDungHienThi(valcm) {
    for (var i = 0; i < 3; i++) {
        var ddt = ldodaithuoc[i];
        var gt = (valcm * 10) % ddt;
        var numcungr = lnumcung[i];
        var numkhoangr = lnumkhoang[i];
        var lcolor = lmau[i];
        var lcungr = lcung[i];
        var lkhoangr = lkhoang[i];
        var gtCung = "", gtKhoang = "", idxcung = 0, idxkhoang = 0;
        if (gt == 0) {
            idxcung = 1;
            idxkhoang = 1;
        } else if (gt == ddt) {
            idxcung = numcungr;
            idxkhoang = numkhoangr;
        } else if (gt > 0) {
            idxcung = Math.ceil(gt / (ddt / numcungr));
            idxkhoang = Math.ceil(gt / (ddt / numkhoangr));
        }
        if (idxcung != 0) {
            gtCung = lcungr[idxcung - 1];
            gtKhoang = lkhoangr[idxkhoang - 1];
        }
        var result = "";
        switch (i) {
            case 0://thước 52,2cm
                result = "<font color='black'>";
                result = "Độ dài " + valcm + " cm thuộc";
                result += " Cung";
                result += " <font color='" + lcolor[idxcung - 1] + "'><b>"
                    + gtKhoang.toUpperCase() + "</b></font>";
                result += " nằm trong khoảng "
                    + " <font color='" + lcolor[idxcung - 1] + "'><b>"
                    + gtCung.toUpperCase() + "</b></font>";
                result += " - " + note522c[idxcung - 1];
                result += "</font>";
                break;
            case 1://thước 42,9cm
                result = "<font color='" + lcolor[idxcung - 1] + "'>";
                result = "Độ dài " + valcm + " cm thuộc";
                result += " Cung";
                result += " <font color='" + lcolor[idxcung - 1] + "'><b>"
                    + gtKhoang.toUpperCase() + "</b></font>";
                result += " ("
                    + note429k[idxkhoang - 1]
                    + ")";
                result += " nằm trong khoảng "
                    + " <font color='" + lcolor[idxcung - 1] + "'><b>"
                    + gtCung.toUpperCase() + "</b></font>";
                result += " - " + note429c[idxcung - 1];
                result += " <br/>" + note429c2[idxcung - 1];
                result += "</font>";
                break;
            case 2://thước 38,8cm
                result = "<font color='" + lcolor[idxcung - 1] + "'>";
                result = "Độ dài " + valcm + " cm thuộc";
                result += " Cung";
                result += " <font color='" + lcolor[idxcung - 1] + "'><b>"
                    + gtKhoang.toUpperCase() + "</b></font>";
                result += " ("
                    + note388k[idxkhoang - 1]
                    + ")";
                result += " nằm trong khoảng "
                    + " <font color='" + lcolor[idxcung - 1] + "'><b>"
                    + gtCung.toUpperCase() + "</b></font>";
                result += " - " + note388c[idxcung - 1];
                result += "</font>";
                break;
        }
        $('#nd' + ddt + '-text').html(result);
    }
}
